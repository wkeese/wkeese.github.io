<html>
<head>
	<meta charset="utf-8">
	<script src="requirejs/require.js"></script>
	<script>
		require([
			"delite/register", "delite/KeyNav", "dojo/query", "dojo/domReady!"
		], function(register, KeyNav){
			var List = register("my-nav-list", [HTMLElement, KeyNav], {
				buildRendering: function(){
					this.containerNode = this;
				},

				// Specifies which descendants can be navigated to
				childSelector: "*",

				_getCurrentListItem: function () {
					// Returns the list item that contains the currently focused child
					var li = this.focusedChild;
					while ( li.parentNode != this ){
						li = li.parentNode;
					}
					return li;
				},

				_getListItemChildren: function (li) {
					// Returns the navigable children of the specified or current list item, plus the list item
					// itself, if it's navigable.
					li = li || this._getCurrentListItem();
					return (li.hasAttribute("navindex") ? [li] : []).concat(
						Array.prototype.slice.call(li.querySelectorAll("[navindex]")));
				},

				// Home/End key support
				_getFirst: function(){
					return this._getListItemChildren(this.firstElementChild)[0];
				},
				_getLast: function(){
					// should this go to last list item, or last field in last list item?
					return this._getListItemChildren(this.lastElementChild)[0];
				},

				// Simple arrow key support.
				_onDownArrow: function(){
					// Go to next list item (focusing first navigable field or list item itself)
					var li = this._getCurrentListItem(),
						nextLi = li.nextElementSibling || this.firstElementChild,
						children = this._getListItemChildren(nextLi);
					this.focusChild(children[0]);
				},
				_onUpArrow: function(){
					// Go to previous list item (focusing first navigable field or list item itself)
					var li = this._getCurrentListItem(),
						prevLi = li.previousElementSibling || this.lastElementChild,
						children = this._getListItemChildren(prevLi);
					this.focusChild(children[0]);
				},
				_onRightArrow: function(){
					// Loop through fields in current list item
					var li = this._getCurrentListItem(),
						children = this._getListItemChildren(li),
						idx = Array.prototype.indexOf.call(children, this.focusedChild);
					this.focusChild(children[(idx + 1) % children.length]);
				},
				_onLeftArrow: function(){
					// Loop through fields in current list item
					var li = this._getCurrentListItem(),
						children = this._getListItemChildren(li),
						idx = Array.prototype.indexOf.call(children, this.focusedChild);
					this.focusChild(children[(idx - 1 + children.length) % children.length]);
				}
			});

			register.parse();
		});
	</script>
	<style>
		my-nav-list {
			border: 2px solid black;
			padding: 2px;
			display: block;
		}

		/* listitem */
		my-nav-list > div {
			border: 2px solid gray;
			padding: 5px;
			margin: 3px;
			position: relative;
			background: #eee;
		}

		/* listitem children */
		a {
			border: 1px solid blue;
			padding: 2px;
			margin: 3px;
			background: #fff;
			display: block;
		}
		.multiple a {
			display: inline-block;
			min-width: 90%;
		}
		a:before {
			float: right;
			content: "â†’"

		}
		*:focus {
			background-color: yellow;
		}
		button {
			position: absolute;
			right: 10px;
		}
	</style>
</head>
<body>
	<p id="singleLabel">
		Navigation list w/single active element:
	</p>
	<input value="for focus test"/>
	<my-nav-list role="list" aria-labelledby="singleLabel">
		<div role=listitem>
			<a href="http://www.yahoo.com" tabindex="-1" navindex="0">Yahoo!</a>
		</div>
		<div role=listitem>
			<a href="http://www.google.com" tabindex="-1" navindex="0">Google</a>
		</div>
		<div role=listitem>
			<a href="http://www.ibm.com" tabindex="-1" navindex="0">IBM</a>
		</div>
	</my-nav-list>

	<p id="multipleLabel">
		Navigation list w/multiple active elements:
	</p>
	<input value="for focus test"/>
	<my-nav-list  role="list" aria-labelledby="multipleLabel" class="multiple">
		<div role=listitem navindex="0">
			<a href="http://www.yahoo.com" tabindex="-1" navindex="0">Yahoo!</a>
			<button type="button" tabindex="-1" navindex="0">delete</button>
		</div>
		<div role=listitem navindex="0">
			<a href="http://www.google.com" tabindex="-1" navindex="0">Google</a>
			<button type="button" tabindex="-1" navindex="0">delete</button>
		</div>
		<div role=listitem navindex="0">
			<a href="http://www.ibm.com" tabindex="-1" navindex="0">IBM</a>
			<button type="button" tabindex="-1" navindex="0">delete</button>
		</div>
	</my-nav-list>

	<p id="singleOptionLabel">
		role=listbox w/single active element:
	</p>
	<input value="for focus test"/>
	<my-nav-list role="listbox" aria-labelledby="singleOptionLabel">
		<div role=option>
			<a href="http://www.yahoo.com" tabindex="-1" navindex="0">Yahoo!</a>
		</div>
		<div role=option>
			<a href="http://www.google.com" tabindex="-1" navindex="0">Google</a>
		</div>
		<div role=option>
			<a href="http://www.ibm.com" tabindex="-1" navindex="0">IBM</a>
		</div>
	</my-nav-list>

	<p id="multipleOptionLabel">
		role=listbox w/multiple active elements:
	</p>
	<input value="for focus test"/>
	<my-nav-list  role="listbox" aria-labelledby="multipleOptionLabel" class="multiple">
		<div role=option navindex="0">
			<a href="http://www.yahoo.com" tabindex="-1" navindex="0">Yahoo!</a>
			<button type="button" tabindex="-1" navindex="0">delete</button>
		</div>
		<div role=option navindex="0">
			<a href="http://www.google.com" tabindex="-1" navindex="0">Google</a>
			<button type="button" tabindex="-1" navindex="0">delete</button>
		</div>
		<div role=option navindex="0">
			<a href="http://www.ibm.com" tabindex="-1" navindex="0">IBM</a>
			<button type="button" tabindex="-1" navindex="0">delete</button>
		</div>
	</my-nav-list>
</body>
</html>